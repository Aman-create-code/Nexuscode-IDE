<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>NexusCode IDE | Professional</title>
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/editor/editor.main.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/microsoft-codicons/0.0.17/codicon.min.css" rel="stylesheet">
    
    <style>
        :root {
            --activity-bg: #24292e; --sidebar-bg: #1b1f23; --editor-bg: #0d1117;
            --panel-bg: #0d1117; --status-bg: #21262d; --accent: #58a6ff;
            --border: #30363d; --tab-active: #0d1117; --tab-inactive: #161b22;
            --text: #c9d1d9; --text-muted: #8b949e;
        }

        body, html { margin: 0; height: 100vh; overflow: hidden; font-family: -apple-system, system-ui, sans-serif; background: var(--editor-bg); color: var(--text); }

        /* Das 1:1 Grid Layout */
        .app-container {
            display: grid;
            grid-template-columns: 48px 260px 1fr;
            grid-template-rows: 1fr 240px 22px;
            height: 100vh;
        }

        /* A: Activity Bar (1:1 Design) */
        .activity-bar {
            grid-row: 1 / 3;
            background: var(--activity-bg);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column; align-items: center; padding-top: 12px; gap: 20px;
        }
        .act-icon { font-size: 24px; color: var(--text-muted); cursor: pointer; transition: 0.2s; position: relative; width: 100%; text-align: center; }
        .act-icon:hover { color: white; }
        .act-icon.active { color: white; }
        .act-icon.active::before { content: ''; position: absolute; left: 0; top: 0; height: 100%; width: 2px; background: white; }

        /* B: Sidebar */
        .sidebar { grid-row: 1 / 3; background: var(--sidebar-bg); border-right: 1px solid var(--border); }
        .sidebar-header { padding: 10px 16px; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; display: flex; justify-content: space-between; }
        .file-list { list-style: none; padding: 0; margin: 0; }
        .file { padding: 6px 16px; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .file:hover { background: #21262d; }
        .file.active { background: #2d333b; color: white; }

        /* C: Editor & Tab Bar */
        .editor-area { display: flex; flex-direction: column; background: var(--editor-bg); }
        .tab-container { display: flex; background: var(--tab-inactive); height: 35px; border-bottom: 1px solid var(--border); align-items: center; }
        .tab { padding: 8px 16px; font-size: 12px; border-right: 1px solid var(--border); cursor: pointer; display: flex; align-items: center; gap: 8px; position: relative; }
        .tab.active { background: var(--tab-active); color: white; border-top: 1px solid var(--accent); }
        
        .ipad-tab { margin-left: auto; padding-right: 15px; cursor: pointer; color: var(--accent); font-size: 18px; }
        .ipad-tab:hover { transform: scale(1.1); }

        #monaco-editor { flex-grow: 1; }

        /* D: Panel Area */
        .panel-area { grid-column: 3 / 4; background: var(--panel-bg); border-top: 1px solid var(--border); display: grid; grid-template-columns: 1fr 1fr; }
        .terminal-box { border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .panel-nav { display: flex; gap: 15px; padding: 0 15px; font-size: 11px; height: 30px; align-items: center; border-bottom: 1px solid var(--border); }
        #console { flex-grow: 1; padding: 10px; font-family: 'Fira Code', monospace; font-size: 12px; overflow-y: auto; color: #7ee787; }
        iframe { width: 100%; height: 100%; border: none; background: white; }

        /* E: Status Bar */
        .status-bar { grid-column: 1 / 4; background: var(--status-bg); border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; padding: 0 12px; font-size: 12px; }
        .status-left { background: var(--accent); color: white; padding: 0 10px; height: 100%; display: flex; align-items: center; gap: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="activity-bar">
        <div class="act-icon codicon codicon-files active"></div>
        <div class="act-icon codicon codicon-search"></div>
        <div class="act-icon codicon codicon-source-control"></div>
        <div class="act-icon codicon codicon-debug-alt"></div>
        <div class="act-icon codicon codicon-extensions"></div>
        <div style="flex-grow: 1;"></div>
        <div class="act-icon codicon codicon-account"></div>
        <div class="act-icon codicon codicon-settings-gear"></div>
    </div>

    <div class="sidebar">
        <div class="sidebar-header"><span>EXPLORER: NEXUS</span> <i class="codicon codicon-ellipsis"></i></div>
        <ul class="file-list">
            <li class="file active" onclick="load('html')"><i class="codicon codicon-symbol-structure" style="color:#e34c26"></i> index.html</li>
            <li class="file" onclick="load('css')"><i class="codicon codicon-symbol-variable" style="color:#58a6ff"></i> style.css</li>
            <li class="file" onclick="load('javascript')"><i class="codicon codicon-symbol-method" style="color:#f1e05a"></i> script.js</li>
        </ul>
    </div>

    <div class="editor-area">
        <div class="tab-container">
            <div class="tab active"><i class="codicon codicon-code"></i> <span id="tab-title">index.html</span></div>
            <div class="ipad-tab codicon codicon-device-mobile" title="Auto-Complete Tag" onclick="magicTag()"></div>
        </div>
        <div id="monaco-editor"></div>
    </div>

    <div class="panel-area">
        <div class="terminal-box">
            <div class="panel-nav">
                <span style="color:white; border-bottom: 1px solid white;">TERMINAL</span>
                <span>OUTPUT</span>
                <span>DEBUG</span>
            </div>
            <div id="console">> Workspace geladen. Schreibe ein Wort (z.B. h1) und drücke das iPad Icon!</div>
        </div>
        <div class="preview-box"><iframe id="preview-frame"></iframe></div>
    </div>

    <footer class="status-bar">
        <div class="status-left"><i class="codicon codicon-remote"></i> codespaces</div>
        <div style="flex-grow: 1; padding-left: 15px; color: var(--text-muted);">main* | Ln 1, Col 1</div>
        <div style="color: var(--text-muted);">amancreatecode Copyright 2026</div>
    </footer>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>
<script>
    let editor;
    let currentMode = 'html';
    let project = JSON.parse(localStorage.getItem('nexus_pro_v4')) || {
        html: `<h1>NexusCode IDE</h1>\n<p>Tippe 'h1' und klicke das iPad Icon!</p>`,
        css: `body { background: #0d1117; color: white; font-family: sans-serif; text-align: center; padding-top: 100px; }`,
        javascript: `console.log("Ready.");`
    };

    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }});
    require(['vs/editor/editor.main'], function() {
        editor = monaco.editor.create(document.getElementById('monaco-editor'), {
            value: project[currentMode],
            language: 'html',
            theme: 'vs-dark',
            automaticLayout: true,
            fontFamily: "'Fira Code', monospace",
            fontSize: 13,
            renderLineHighlight: 'all',
            minimap: { enabled: true }
        });

        editor.onDidChangeModelContent(() => {
            project[currentMode] = editor.getValue();
            localStorage.setItem('nexus_pro_v4', JSON.stringify(project));
            updatePreview();
        });
        updatePreview();
    });

    // DIE MAGISCHE FUNKTION: h1 -> <h1></h1>
    function magicTag() {
        const selection = editor.getSelection();
        const word = editor.getModel().getWordAtPosition(selection.getStartPosition());
        
        if (word) {
            const range = new monaco.Range(selection.startLineNumber, word.startColumn, selection.startLineNumber, word.endColumn);
            const tag = word.word;
            const replacement = `<${tag}></${tag}>`;
            
            editor.executeEdits("magic-tag", [{
                range: range,
                text: replacement,
                forceMoveMarkers: true
            }]);
            
            // Cursor in die Mitte setzen
            editor.setPosition({ lineNumber: selection.startLineNumber, column: word.startColumn + tag.length + 2 });
            editor.focus();
        }
    }

    function load(file) {
        project[currentMode] = editor.getValue();
        currentMode = file;
        document.getElementById('tab-title').innerText = file === 'javascript' ? 'script.js' : (file === 'css' ? 'style.css' : 'index.html');
        monaco.editor.setModelLanguage(editor.getModel(), file === 'javascript' ? 'javascript' : file);
        editor.setValue(project[file]);
        document.querySelectorAll('.file').forEach(f => f.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    function updatePreview() {
        const frame = document.getElementById('preview-frame');
        const code = `<html><head><style>${project.css}</style></head><body>${project.html}<script>
            console.log = (m) => window.parent.postMessage(m, "*");
            try { ${project.javascript} } catch(e) { }
        <\/script></body></html>`;
        frame.srcdoc = code;
    }

    window.onmessage = (e) => {
        const c = document.getElementById('console');
        c.innerHTML += `<br><span style="color:#58a6ff">➜</span> ${e.data}`;
        c.scrollTop = c.scrollHeight;
    };
</script>
</body>
</html>
